# Manu√°l: Zprovoznƒõn√≠ kalend√°≈ôe s emailov√Ωm propojen√≠m

## P≈ôehled

Tento manu√°l v√°m pom≈Ø≈æe nastavit automatick√© pos√≠l√°n√≠ email≈Ø p≈ôi registraci na ud√°losti v kalend√°≈ôi va≈°eho webu. Pokr√Ωv√° t≈ôi hlavn√≠ zp≈Øsoby propojen√≠:

1. **EmailJS** - Nejjednodu≈°≈°√≠ ≈ôe≈°en√≠ pro zaƒç√°teƒçn√≠ky
2. **Zapier** - Automatizace bez programov√°n√≠
3. **Supabase + EmailJS** - Pokroƒçil√© ≈ôe≈°en√≠ s datab√°z√≠

---

## üöÄ Metoda 1: EmailJS (Doporuƒçeno pro zaƒç√°teƒçn√≠ky)

### Krok 1: Registrace na EmailJS

1. Jdƒõte na [emailjs.com](https://emailjs.com)
2. Vytvo≈ôte si √∫ƒçet (zdarma do 200 email≈Ø/mƒõs√≠c)
3. P≈ôihlaste se do dashboardu

### Krok 2: Nastaven√≠ emailov√© slu≈æby

1. V dashboardu kliknƒõte na **"Email Services"**
2. Kliknƒõte **"Add New Service"**
3. Vyberte v√°≈° email provider (Gmail, Outlook, atd.)
4. Zadejte va≈°e emailov√© √∫daje
5. Poznamenejte si **Service ID**

### Krok 3: Vytvo≈ôen√≠ emailov√© ≈°ablony

1. Kliknƒõte na **"Email Templates"**
2. Kliknƒõte **"Create New Template"**
3. Nastavte ≈°ablonu:

```html
Subject: Registrace na ud√°lost - {{event_name}}

Ahoj {{user_name}},

dƒõkujeme za registraci na ud√°lost "{{event_name}}".

Detaily ud√°losti:
- N√°zev: {{event_name}}
- Datum: {{event_date}}
- Email: {{user_email}}
- Telefon: {{user_phone}}
- Zpr√°va: {{message}}

S pozdravem,
T√Ωm Nech Mƒõ R≈Øst

---
Automaticky generovan√Ω email
```

4. Poznamenejte si **Template ID**

### Krok 4: Z√≠sk√°n√≠ API kl√≠ƒç≈Ø

1. Jdƒõte do **"Account"** ‚Üí **"API Keys"**
2. Poznamenejte si **Public Key**

### Krok 5: Instalace EmailJS

V termin√°lu spus≈•te:
```bash
npm install @emailjs/browser
```

### Krok 6: Aktualizace k√≥du

Vytvo≈ôte soubor `src/lib/email.ts`:

```typescript
import emailjs from '@emailjs/browser';

const EMAILJS_SERVICE_ID = 'YOUR_SERVICE_ID';
const EMAILJS_TEMPLATE_ID = 'YOUR_TEMPLATE_ID';
const EMAILJS_PUBLIC_KEY = 'YOUR_PUBLIC_KEY';

export const sendEventRegistrationEmail = async (data: {
  user_name: string;
  user_email: string;
  user_phone: string;
  event_name: string;
  event_date: string;
  message?: string;
}) => {
  try {
    const result = await emailjs.send(
      EMAILJS_SERVICE_ID,
      EMAILJS_TEMPLATE_ID,
      {
        user_name: data.user_name,
        user_email: data.user_email,
        user_phone: data.user_phone,
        event_name: data.event_name,
        event_date: data.event_date,
        message: data.message || '≈Ω√°dn√° zpr√°va',
        to_email: data.user_email, // Email √∫ƒçastn√≠ka
        admin_email: 'admin@nechmerust.org' // V√°≈° email
      },
      EMAILJS_PUBLIC_KEY
    );
    
    console.log('Email sent successfully:', result);
    return true;
  } catch (error) {
    console.error('Email sending failed:', error);
    return false;
  }
};
```

### Krok 7: Integrace s registraƒçn√≠m formul√°≈ôem

Aktualizujte `EventRegistrationForm.tsx`:

```typescript
import { sendEventRegistrationEmail } from '@/lib/email';

// V handleSubmit funkci p≈ôidejte:
const emailSent = await sendEventRegistrationEmail({
  user_name: formData.name,
  user_email: formData.email,
  user_phone: formData.phone,
  event_name: event.title,
  event_date: event.date,
  message: formData.message
});

if (emailSent) {
  toast({
    title: t('events.register_form.success'),
    description: "Potvrzovac√≠ email byl odesl√°n na va≈°i adresu.",
  });
} else {
  toast({
    title: "Registrace √∫spƒõ≈°n√°",
    description: "Email se nepoda≈ôilo odeslat, ale registrace probƒõhla.",
    variant: "destructive",
  });
}
```

---

## ‚ö° Metoda 2: Zapier (Bez programov√°n√≠)

### Krok 1: Vytvo≈ôen√≠ Zap

1. Jdƒõte na [zapier.com](https://zapier.com)
2. Vytvo≈ôte √∫ƒçet
3. Kliknƒõte **"Create Zap"**

### Krok 2: Nastaven√≠ Triggeru

1. Jako trigger vyberte **"Webhooks by Zapier"**
2. Vyberte **"Catch Hook"**
3. Zkop√≠rujte si **Webhook URL**

### Krok 3: Nastaven√≠ Action

1. Jako action vyberte **"Email by Zapier"** nebo **"Gmail"**
2. Nastavte:
   - **To**: Email z webhook dat
   - **Subject**: "Registrace na ud√°lost"
   - **Body**: Pou≈æijte data z webhooku

### Krok 4: Integrace Zapier webhooku

Vytvo≈ôte `src/lib/zapier.ts`:

```typescript
export const sendToZapier = async (webhookUrl: string, data: any) => {
  try {
    const response = await fetch(webhookUrl, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      mode: "no-cors",
      body: JSON.stringify({
        ...data,
        timestamp: new Date().toISOString(),
        source: "nechmerust_calendar"
      }),
    });
    
    return true;
  } catch (error) {
    console.error("Zapier webhook error:", error);
    return false;
  }
};
```

### Krok 5: P≈ôid√°n√≠ Zapier nastaven√≠

V `Support.tsx` p≈ôidejte pole pro Zapier webhook:

```typescript
const [zapierWebhook, setZapierWebhook] = useState(
  localStorage.getItem('zapier_webhook') || ''
);

// Komponenta pro nastaven√≠
<Card>
  <CardHeader>
    <CardTitle>Zapier Webhook URL</CardTitle>
  </CardHeader>
  <CardContent>
    <input
      type="url"
      value={zapierWebhook}
      onChange={(e) => {
        setZapierWebhook(e.target.value);
        localStorage.setItem('zapier_webhook', e.target.value);
      }}
      placeholder="https://hooks.zapier.com/hooks/catch/..."
      className="w-full p-2 border rounded"
    />
  </CardContent>
</Card>
```

---

## üóÑÔ∏è Metoda 3: Supabase + Email (Pokroƒçil√©)

### Krok 1: Nastaven√≠ Supabase

1. Jdƒõte na [supabase.com](https://supabase.com)
2. Vytvo≈ôte nov√Ω projekt
3. Poznamenejte si **URL** a **API Key**

### Krok 2: Vytvo≈ôen√≠ tabulky

V Supabase SQL editoru:

```sql
-- Vytvo≈ôen√≠ tabulky pro registrace
CREATE TABLE event_registrations (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  event_name TEXT NOT NULL,
  event_date TEXT NOT NULL,
  user_name TEXT NOT NULL,
  user_email TEXT NOT NULL,
  user_phone TEXT,
  message TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- RLS politiky
ALTER TABLE event_registrations ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Allow insert for all users" ON event_registrations
  FOR INSERT WITH CHECK (true);

CREATE POLICY "Allow select for all users" ON event_registrations
  FOR SELECT USING (true);
```

### Krok 3: Instalace Supabase

```bash
npm install @supabase/supabase-js
```

### Krok 4: Konfigurace Supabase

Vytvo≈ôte `src/lib/supabase.ts`:

```typescript
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = 'YOUR_SUPABASE_URL';
const supabaseKey = 'YOUR_SUPABASE_ANON_KEY';

export const supabase = createClient(supabaseUrl, supabaseKey);

export const saveRegistration = async (data: {
  event_name: string;
  event_date: string;
  user_name: string;
  user_email: string;
  user_phone: string;
  message?: string;
}) => {
  const { data: result, error } = await supabase
    .from('event_registrations')
    .insert([data]);
    
  if (error) {
    console.error('Supabase error:', error);
    return false;
  }
  
  return true;
};
```

### Krok 5: Edge Function pro emaily

V Supabase vytvo≈ôte Edge Function:

```typescript
import { serve } from "https://deno.land/std@0.168.0/http/server.ts"

const handler = async (req: Request): Promise<Response> => {
  const { user_email, user_name, event_name, event_date } = await req.json()

  // Zde implementujte pos√≠l√°n√≠ email≈Ø pomoc√≠ extern√≠ slu≈æby
  // Nap≈ô√≠klad SendGrid, Mailgun, nebo SMTP
  
  return new Response(
    JSON.stringify({ success: true }),
    { headers: { "Content-Type": "application/json" } }
  )
}

serve(handler)
```

---

## üìß Konfigurace emailov√Ωch ≈°ablon

### ≈†ablona pro √∫ƒçastn√≠ka

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Potvrzen√≠ registrace</title>
</head>
<body style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">
  <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
    <h2 style="color: #2d4a3e;">Dƒõkujeme za registraci! üå±</h2>
    
    <p>Ahoj <strong>{{user_name}}</strong>,</p>
    
    <p>Va≈°e registrace na ud√°lost byla √∫spƒõ≈°nƒõ p≈ôijata.</p>
    
    <div style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 20px 0;">
      <h3 style="margin-top: 0;">Detaily ud√°losti:</h3>
      <ul style="list-style: none; padding: 0;">
        <li><strong>Ud√°lost:</strong> {{event_name}}</li>
        <li><strong>Datum:</strong> {{event_date}}</li>
        <li><strong>Email:</strong> {{user_email}}</li>
        <li><strong>Telefon:</strong> {{user_phone}}</li>
      </ul>
    </div>
    
    <p>Tƒõ≈°√≠me se na setk√°n√≠ s v√°mi!</p>
    
    <p style="color: #666; font-size: 0.9em;">
      S pozdravem,<br>
      T√Ωm Nech Mƒõ R≈Øst z.s.
    </p>
  </div>
</body>
</html>
```

### ≈†ablona pro administr√°tory

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Nov√° registrace</title>
</head>
<body style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">
  <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
    <h2 style="color: #2d4a3e;">Nov√° registrace na ud√°lost üìù</h2>
    
    <div style="background: #f5f5f5; padding: 15px; border-radius: 5px;">
      <h3 style="margin-top: 0;">Detaily registrace:</h3>
      <ul style="list-style: none; padding: 0;">
        <li><strong>Ud√°lost:</strong> {{event_name}}</li>
        <li><strong>Datum ud√°losti:</strong> {{event_date}}</li>
        <li><strong>Jm√©no:</strong> {{user_name}}</li>
        <li><strong>Email:</strong> {{user_email}}</li>
        <li><strong>Telefon:</strong> {{user_phone}}</li>
        <li><strong>Zpr√°va:</strong> {{message}}</li>
        <li><strong>ƒåas registrace:</strong> {{timestamp}}</li>
      </ul>
    </div>
  </div>
</body>
</html>
```

---

## üîß Testov√°n√≠ a ladƒõn√≠

### 1. Testov√°n√≠ EmailJS

```typescript
// Testovac√≠ funkce
const testEmail = async () => {
  const result = await sendEventRegistrationEmail({
    user_name: "Test U≈æivatel",
    user_email: "test@example.com",
    user_phone: "+420 123 456 789",
    event_name: "Testovac√≠ ud√°lost",
    event_date: "2024-01-15",
    message: "Testovac√≠ zpr√°va"
  });
  
  console.log("Email test result:", result);
};
```

### 2. Ladƒõn√≠ Zapier

- Kontrolujte **Zap History** v Zapier dashboardu
- Pou≈æijte **Test** funkci p≈ôed publikov√°n√≠m
- Zkontrolujte form√°t dat v webhooku

### 3. Monitoring

```typescript
// P≈ôidejte logov√°n√≠
const logEmailEvent = (type: string, success: boolean, data: any) => {
  console.log(`Email ${type}:`, {
    success,
    timestamp: new Date().toISOString(),
    data
  });
  
  // Volitelnƒõ ulo≈æte do localStorage pro ladƒõn√≠
  const logs = JSON.parse(localStorage.getItem('email_logs') || '[]');
  logs.push({ type, success, data, timestamp: new Date().toISOString() });
  localStorage.setItem('email_logs', JSON.stringify(logs.slice(-50))); // Posledn√≠ch 50 log≈Ø
};
```

---

## üì± Mobiln√≠ optimalizace

Ujistƒõte se, ≈æe emailov√© ≈°ablony jsou responzivn√≠:

```html
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  @media only screen and (max-width: 600px) {
    .container {
      width: 100% !important;
      padding: 10px !important;
    }
  }
</style>
```

---

## üîí Bezpeƒçnost

### 1. Ochrana API kl√≠ƒç≈Ø

- Nikdy neukl√°dejte citliv√© kl√≠ƒçe v k√≥du
- Pou≈æijte environment promƒõnn√©
- Pro EmailJS pou≈æ√≠vejte pouze **Public Key**

### 2. Validace dat

```typescript
const validateRegistrationData = (data: any) => {
  const required = ['user_name', 'user_email', 'event_name', 'event_date'];
  
  for (const field of required) {
    if (!data[field] || data[field].trim() === '') {
      throw new Error(`Povinn√© pole ${field} chyb√≠`);
    }
  }
  
  // Validace emailu
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(data.user_email)) {
    throw new Error('Neplatn√Ω form√°t emailu');
  }
  
  return true;
};
```

---

## üéØ Doporuƒçen√≠ pro produkci

1. **Zaƒçnƒõte s EmailJS** - nejjednodu≈°≈°√≠ implementace
2. **P≈ôidejte backup** - kombinujte v√≠ce metod
3. **Sledujte limity** - EmailJS m√° limit 200 email≈Ø/mƒõs√≠c zdarma
4. **Testujte d≈Økladnƒõ** - p≈ôed spu≈°tƒõn√≠m otestujte v≈°echny sc√©n√°≈ôe
5. **Mƒõjte fallback** - pokud email sel≈æe, ulo≈æte registraci lok√°lnƒõ

---

## üìû Podpora

Pokud naraz√≠te na probl√©my:

1. Zkontrolujte browser konzoli pro chyby
2. Ovƒõ≈ôte API kl√≠ƒçe a konfigurace
3. Otestujte p≈ôipojen√≠ k internetu
4. Kontaktujte podporu p≈ô√≠slu≈°n√© slu≈æby

---

**Pozn√°mka:** Tento manu√°l p≈ôedpokl√°d√° z√°kladn√≠ znalost React/TypeScript. Pro pokroƒçil√© funkce doporuƒçujeme konzultaci s v√Ωvoj√°≈ôem.